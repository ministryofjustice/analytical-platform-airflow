---
dag:
  repository: ministryofjustice/replicate-athena-to-fabric
  tag: v1.1.2
  catchup: false
  compute_profile: general-on-demand-2vcpu-8gb
  max_active_runs: 1
  retries: 1
  env_vars:
    AWS_DEFAULT_REGION: "eu-west-1"
    AWS_ATHENA_QUERY_EXTRACT_REGION: "eu-west-1"
    DATABASE: "athena_query_executions"
  tasks:
    top-1000-users:
      env_vars:
        TABLE: "queries_by_user"
        ATHENA_QUERY_LIMIT: "1000"
    top-100-databases:
      env_vars:
        TABLE: "queries_by_db"
        ATHENA_QUERY_LIMIT: "100"
    statuses:
      env_vars:
        TABLE: "query_statuses"
    runtime-metrics:
      env_vars:
        TABLE: "query_time_metrics"

iam:
  athena: write
  glue: true
  s3_read_write:
    - alpha-corp-data-staging/athena_queries/*
    - mojap-athena-query-dump/*

secrets:
  - azure-client-id
  - azure-tenant-id
  - azure-client-secret
  - fabric-warehouse-endpoint
  - fabric-warehouse-name

maintainers:
  - moj-supratikc
  - DanJ-MOJ

tags:
  business_unit: Central Digital
  owner: supratik.chowdhury@justice.gov.uk
